# 企业知识图谱构建与可视化实现方案

## 1. 项目概述
基于 py2neo 和 Cypher 的企业知识图谱构建与可视化项目，使用 Neo4j 图数据库存储企业、行业、股东、概念等实体及其关系。

## 2. 数据准备
### 2.1 数据集结构
- **enterprise_basic.csv**: 企业基础信息（股票代码、企业名称、行业、交易所）
- **enterprise_concept.csv**: 企业概念关联（概念名称、股票代码）
- **enterprise_holders.csv**: 企业股东信息（股票代码、公告日期、报告期、股东名称、持有数量、持有比例）
- **stock_prices.csv**: 股票价格数据（股票代码、交易日期、收盘价）

### 2.2 数据规模
- 企业数量：约300家
- 概念数量：数百个概念标签
- 股东数量：数千个股东实体
- 价格数据：时间序列数据用于计算相关性

## 3. 技术架构
### 3.1 核心技术栈
- **Python 3.x**: 主要开发语言
- **py2neo**: Neo4j Python驱动，用于图数据库操作
- **pandas**: 数据处理与分析
- **numpy**: 数值计算（相关系数计算）
- **Neo4j**: 图数据库服务器
- **Docker**: Neo4j服务容器化部署

### 3.2 环境配置
```bash
# Neo4j连接配置
uri = "bolt://localhost:7687"
auth = ("neo4j", "password")
graph = Graph(profile="http://localhost:7474/", auth=auth)
```

## 4. 知识图谱构建流程

### 4.1 实体创建
1. **企业实体** (标签: "企业")
   - 属性：企业名称、股票代码
   - 去重：基于企业名称+股票代码组合

2. **行业实体** (标签: "行业")
   - 属性：行业名称
   - 去重：基于行业名称唯一值

3. **股东实体** (标签: "股东")
   - 属性：股东名称
   - 去重：基于股东名称唯一值

4. **概念实体** (标签: "概念")
   - 属性：概念名称
   - 去重：基于概念名称唯一值

### 4.2 关系创建
1. **企业-企业关系** (相关性关系)
   - 计算逻辑：基于股票价格收益率的皮尔逊相关系数
   - 阈值：|相关系数| ≥ 0.5
   - 关系类型："正相关" (corrcoef > 0) 或 "负相关" (corrcoef < 0)
   - 属性：相关系数值

2. **企业-行业关系** (行业归属)
   - 关系类型："行业属于"
   - 建立企业与其所属行业的关联

3. **企业-股东关系** (持股关系)
   - 关系类型："参股"
   - 属性：持有数量、持有比例、公告日期、报告期
   - 方向：股东 → 企业（股东参股企业）

4. **企业-概念关系** (概念归属)
   - 关系类型："概念属于"
   - 建立企业与其相关概念的关联

### 4.3 核心算法
```python
def compute_corrcoef(stock_return: np.ndarray):
    corrcoef = np.corrcoef(stock_return)
    corrcoef[np.isnan(corrcoef)] = 0  # nan位置置0
    return corrcoef
```

## 5. 可视化查询方案

### 5.1 基础查询
1. **查看平安银行的持股股东**
```cypher
MATCH p=(m:股东)-[]->(n:企业) 
WHERE n.企业名称="平安银行" 
RETURN p
```

2. **查看与平安银行相关系数>0.8的企业**
```cypher
MATCH p=(m:企业)-[r]->(n:企业)  
WHERE (m.企业名称="平安银行" OR n.企业名称="平安银行") 
  AND abs(r.相关系数) > 0.8 
RETURN p
```

3. **查看与平安银行同行业的企业**
```cypher
MATCH p=(m:企业)-[]->(n:行业)<-[]-(m2:企业)  
WHERE m.企业名称="平安银行" 
RETURN p
```

### 5.2 扩展查询建议
1. **行业聚类分析**：查看特定行业内所有企业及其关联
2. **股东网络分析**：查看主要股东的投资组合
3. **概念热点分析**：查看热门概念下的企业集群
4. **风险传导分析**：基于相关性分析风险传播路径

## 6. 实施步骤

### 6.1 环境准备
1. 确保Neo4j Docker容器正常运行
2. 安装Python依赖：py2neo, pandas, numpy
3. 准备数据集文件

### 6.2 数据加载与处理
1. 读取所有CSV数据文件
2. 数据清洗和预处理
3. 实体去重处理

### 6.3 知识图谱构建
1. 按顺序创建各类实体
2. 建立实体间关系
3. 验证数据完整性

### 6.4 可视化验证
1. 在Neo4j Browser中执行Cypher查询
2. 验证图谱结构和关系
3. 进行示例分析

## 7. 注意事项

### 7.1 性能优化
- 批量创建实体和关系
- 使用索引提高查询性能
- 合理设置相关系数阈值

### 7.2 数据质量
- 处理缺失值和异常值
- 确保实体唯一性
- 验证关系准确性

### 7.3 扩展性
- 支持增量数据更新
- 灵活调整相关性阈值
- 可扩展新的实体和关系类型

## 8. 预期成果

### 8.1 知识图谱结构
- 实体：企业、行业、股东、概念
- 关系：相关性、行业归属、持股、概念归属
- 属性：丰富的实体和关系属性

### 8.2 分析能力
- 企业关联分析
- 行业聚类分析
- 股东网络分析
- 概念热点追踪
- 风险传导分析

### 8.3 可视化展示
- 交互式图探索
- 多层次关系展示
- 动态过滤和查询